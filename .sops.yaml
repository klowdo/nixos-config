# SOPS Configuration for NixOS secrets management
# Supports both regular age keys and YubiKey-based age keys (via age-plugin-yubikey)
#
# To add a YubiKey:
#   1. Run: just yubikey-setup (interactive) or just yubikey-identity
#   2. Copy the public key (starts with age1yubikey1...)
#   3. Add it to the yubikeys section below
#   4. Run: just sops-updatekeys
#
# To generate a new regular age key:
#   1. Run: just sops-init (user) or just age-keys (host)
#   2. Get public key: age-keygen -y ~/.config/sops/age/keys.txt

keys:
  # Regular age keys (software-based)
  - &users:
    - &klowdo age1wt9qhrn6u338ajank9d0vjsgs5ayaky67auewm3065zprhdahaxsjcmsnk
  - &hosts:
    - &dellicious age1k4tndfec2ly2myp2tfrhhqhh4dxqsw25c0rwl92x90tyzmed947qk402t7
    - &tmpdellicious age1tpm1qdfzkk7fq8hk0zdr2g8fyny309898rzgy533z7slv6v87v3c2tg2suaxn7d

  # YubiKey-based age keys (hardware-backed, via age-plugin-yubikey)
  # Generate with: just yubikey-setup
  # Keys look like: age1yubikey1q...
  - &yubikeys:
    - &yubikey-keychain age1yubikey1qdxu9y7v7pljxaq7ge5hx9zcdeyq8cld4af8d0meznwg02m0q4gt6mnvzyq
    - &yubikey-home age1yubikey1qda2gdlsswzvc3mhwek8mzmjrg87mm2q06dad6pjdmu259npe5hkxyymsll

creation_rules:
  - path_regex: secrets.yaml$
    key_groups:
      - age:
          - *klowdo
          - *dellicious
          - *tmpdellicious
          - *yubikey-keychain
          - *yubikey-home
